# Инструкция по локальной установке

## Предварительные требования

- Node.js (версия 16 или выше)
- npm (последняя стабильная версия)
- Git

## Установка n8n

1. Установите n8n глобально:
```bash
npm install n8n -g
```

2. Запустите n8n:
```bash
n8n start
```

После запуска, интерфейс n8n будет доступен по адресу: `http://localhost:5678`

## Установка пакета TelePilot

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/n8n-nodes-telepilot.git
cd n8n-nodes-telepilot
```

2. Установите зависимости:
```bash
npm install
```

3. Соберите пакет:
```bash
npm run build
```

4. Создайте символическую ссылку на пакет:
```bash
npm link
```

5. Перейдите в директорию с установленным n8n (обычно это ~/.n8n) и подключите пакет:
```bash
cd ~/.n8n
npm link @vcc-community/n8n-nodes-telepilot
```

6. Перезапустите n8n:
```bash
n8n start
```

## Проверка установки

1. Откройте веб-интерфейс n8n (http://localhost:5678)
2. Создайте новый рабочий процесс
3. В списке узлов должен появиться узел TelePilot

## Устранение проблем

Если узел TelePilot не появился в интерфейсе n8n:

1.  **Проверьте успешность сборки пакета:**
    Убедитесь, что команда `npm run build` в директории пакета `n8n-nodes-telepilot` завершилась без ошибок.

2.  **Проверьте правильность создания символических ссылок:**

    *   **Ссылка на сам пакет:**
        В директории вашего пакета (`n8n-nodes-telepilot`) после выполнения `npm link` должна появиться глобальная символическая ссылка. Проверить это можно так (путь может немного отличаться в зависимости от конфигурации npm):
        ```bash
        ls -l $(npm config get prefix)/lib/node_modules/@vcc-community/n8n-nodes-telepilot
        ```
        Эта команда должна показать, что `@vcc-community/n8n-nodes-telepilot` является ссылкой на директорию вашего пакета.

    *   **Ссылка в директории n8n:**
        В директории `~/.n8n/node_modules/` (или в кастомной директории узлов n8n, если вы ее используете) должна существовать символическая ссылка с именем вашего пакета (`@vcc-community/n8n-nodes-telepilot`), указывающая на глобальную ссылку, созданную на предыдущем шаге.
        Проверить это можно так:
        ```bash
        ls -l ~/.n8n/node_modules/@vcc-community/n8n-nodes-telepilot
        ```
        Результат должен показывать, что это символическая ссылка.

3.  **Перезапустите n8n:**
    Обязательно полностью остановите и снова запустите n8n после выполнения `npm link` и сборки пакета. Иногда простой перезапуск решает проблему.

4.  **Проверьте логи n8n:**
    При запуске n8n просмотрите его консольные логи. Там могут быть сообщения об ошибках при загрузке вашего узла.

5.  **Очистка кэша браузера:**
    Иногда проблема может быть связана с кэшем браузера. Попробуйте очистить кэш для сайта, где открыт n8n, или открыть его в режиме инкогнито.

6.  **Проверьте конфигурацию пользовательских узлов n8n:**
    По умолчанию n8n ищет пользовательские узлы в директории `~/.n8n/node_modules/`. Если в логах n8n вы видите ошибку, что файл `package.json` вашего узла не найден по пути, отличающемуся от `~/.n8n/node_modules/@vcc-community/n8n-nodes-telepilot/package.json` (например, `/Users/vailcody/.n8n/nodes/node_modules/...` как в вашем случае), это означает, что n8n ищет узлы в другом месте.

    Это может быть вызвано:
    *   **Переменной окружения `N8N_CUSTOM_EXTENSIONS_DIR`**: Если эта переменная установлена, n8n будет искать узлы в указанной директории. Убедитесь, что символическая ссылка на ваш пакет (`@vcc-community/n8n-nodes-telepilot`) находится внутри директории, указанной в `N8N_CUSTOM_EXTENSIONS_DIR`, и что путь к `node_modules` внутри этой директории также корректен. Например, если `N8N_CUSTOM_EXTENSIONS_DIR=/Users/vailcody/.n8n/custom_nodes`, то ссылка должна быть в `/Users/vailcody/.n8n/custom_nodes/node_modules/@vcc-community/n8n-nodes-telepilot`.
    *   **Конфигурационным файлом n8n**: Некоторые конфигурации n8n могут изменять стандартный путь поиска узлов. Проверьте ваши файлы конфигурации n8n.

    Убедитесь, что команда `npm link @vcc-community/n8n-nodes-telepilot` была выполнена в правильной директории, соответствующей конфигурации n8n (либо `~/.n8n`, либо в директории, указанной `N8N_CUSTOM_EXTENSIONS_DIR`, создав там поддиректорию `node_modules` если ее нет).

7.  **Проверьте `package.json` вашего узла:**
    Убедитесь, что в файле `package.json` вашего узла (`n8n-nodes-telepilot/package.json`) правильно указаны секции `n8n` и `nodes`. Например:
    ```json
    {
      "name": "@vcc-community/n8n-nodes-telepilot",
      "version": "0.5.3",
      // ... другие поля ...
      "n8n": {
        "n8nNodesApiVersion": 1,
        "credentials": [
          "dist/credentials/TelePilotApi.credentials.js"
        ],
        "nodes": [
          "dist/nodes/TelePilot/TelePilot.node.js",
          "dist/nodes/TelePilot/TelePilotTrigger.node.js"
        ]
      },
      // ... другие поля ...
    }
    ```
    Пути к файлам узлов должны быть корректными относительно корня пакета и указывать на скомпилированные `.js` файлы.

8.  **Проверьте на конфликты имен узлов:**
    Убедитесь, что имя вашего узла (например, `TelePilot`) или его внутренние идентификаторы не конфликтуют с другими установленными узлами.

9.  **Запустите n8n с повышенной детализацией логов:**
    Попробуйте запустить n8n с флагом для более подробного вывода логов, это может помочь выявить проблему:
    ```bash
    N8N_LOG_LEVEL=debug n8n start
    ```
    Ищите в логах сообщения, связанные с загрузкой вашего пакета `@vcc-community/n8n-nodes-telepilot`.

10. **Проверьте совместимость версий:**
    Убедитесь, что версия вашего узла и используемые API n8n совместимы с установленной версией n8n. Иногда для старых версий n8n могут потребоваться другие настройки или версии API узлов.

**Примечание:** Команды `n8n reset` не существует для очистки кэша узлов. Основной способ обновления узлов — это их корректная сборка, связывание через `npm link` и перезапуск n8n.

## Разработка

Для разработки и внесения изменений:
1. Внесите изменения в код
2. Запустите сборку:
```bash
npm run build
```
3. Перезапустите n8n для применения изменений
